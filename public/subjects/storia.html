<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Appunti di Storia – ClayRon</title>
  <link rel="icon" href="../assets/img/logo.png">
  <!-- CSS comuni -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
  <style>
    body { display: flex; flex-direction: column; min-height: 100vh; }
    main { flex: 1; }
    .back-link { display:inline-flex; align-items:center; margin-bottom:1rem; color:#0055aa; text-decoration:none; font-weight:500; }
    .back-link i { margin-right:6px; }
    .card-material { margin-bottom:2rem; border:none; }
    .card-material img { width:100%; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.1); }
    .card-material h3 { color:#003366; margin-bottom:.5rem; }
    .card-material p { color:#444; line-height:1.6; }
  </style>
  <!-- Supabase + auth.js -->
  <script src="https://unpkg.com/@supabase/supabase-js/dist/umd/supabase.js"></script>
  <script>
    const SUPABASE_URL  = 'https://nptawehzfamaghytkmbk.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5wdGF3ZWh6ZmFtYWdoeXRrbWJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU4NzAyMzEsImV4cCI6MjA2MTQ0NjIzMX0.FifPP4WNg7hDFucB_1gBuJQCG4993mBYiKbNyQjpAM8';
    window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
  </script>
  <script src="../assets/js/auth.js"></script>
</head>
<body>

 <!-- Navbar -->
 <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="../index.html">
      <img src="../assets/img/logo.png" class="logo" alt="Logo"> ClayRon S.P.A.
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navCatIt">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navCatIt">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="../materials.html">Materiali</a></li>
        <li class="nav-item"><a class="nav-link" href="../about.html">Chi Siamo</a></li>
        <li class="nav-item"><a class="nav-link" href="../contact.html">Contatti</a></li>
      </ul>
      <div id="auth-area" class="ml-3"></div>
    </div>
  </div>
</nav>

  <main class="container py-5">
    <a href="../materials.html" class="back-link">
      <i class="fas fa-arrow-left"></i> Torna ai Materiali
    </a>
    <h2 class="mb-4">Storia, Cittadinanza e Costituzione</h2>

    <div class="card card-material">
      <div class="row no-gutters">
        <div class="col-md-4">
          <img id="mat-img" src="../assets/img/Progetto senza titolo (1).png" alt="Prima Guerra Mondiale">
        </div>
        <div class="col-md-8">
          <div class="card-body">
            <h3 id="mat-title">LA PRIMA GUERRA MONDIALE – DALLE ALLEANZE AL PRIMO GRANDE CONFLITTO</h3>
            <p id="mat-desc">
              La Prima Guerra Mondiale scoppiò nel 1914 a causa di tensioni…
            </p>
            <div id="download-container">
              <button id="downloadBtn" class="btn btn-success">
                <i class="fas fa-download mr-2"></i> Scarica Appunti
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-primary text-white py-4 mt-auto text-center">
    <div class="container">
      <div class="social-icons mb-2">
        <a href="https://www.instagram.com/clayronhelp/" class="text-white mx-2"><i class="fab fa-instagram"></i></a>
        <a href="https://www.facebook.com/profile.php?id=61575494257613" class="text-white mx-2"><i class="fab fa-facebook-f"></i></a>
        <a href="https://www.tiktok.com/@clayronhelp" class="text-white mx-2"><i class="fab fa-tiktok"></i></a>
      </div>
      <p>&copy; 2025 ClayRon S.P.A. Tutti i diritti riservati.</p>
      <small>
        <a href="../terms.html" class="text-white">Termini &amp; Condizioni</a> – 
        <a href="../cookie.html" class="text-white">Cookie Policy</a>
      </small>
    </div>
  </footer>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', async () => {
    // Proteggi + navbar
    const { data:{ session } } = await supabase.auth.getSession();
    if (!session) return location.href='login.html';
    await updateNavbar();

    const fileUrl = "../assets/uploads/mappa1samueleguerrarussomondiale.pptx";

    // 1) Scarica localmente
    $('#downloadBtn').on('click', async () => {
      // a) localStorage
      const list = JSON.parse(localStorage.getItem('myMaterials')||'[]');
      list.push({ id:'storia', title: $('#mat-title').text(), link: fileUrl, page: window.location.pathname });
      localStorage.setItem('myMaterials', JSON.stringify(list));

      // b) Supabase
      const { data, error } = await supabase.from('downloaded_materials').insert([{
        user_id: session.user.id,
        title: $('#mat-title').text(),
        link: fileUrl,
        page: window.location.pathname
      }]);
      if (error) console.error('Errore salvataggio download:', error.message);

      // c) avvia download
      window.location = fileUrl;
    });
  });
  </script>

</body>
</html>
