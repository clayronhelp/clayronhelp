<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Materiali - ClayRon S.P.A.</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <a class="navbar-brand" href="index.html">ClayRon S.P.A.</a>
    <div class="ml-auto" id="auth-area"></div>
  </nav>

  <div class="container my-5">
    <h2>Materiali Didattici</h2>
    <div id="materialsAccordion">
      <!-- Italiano -->
      <div class="card">
        <div class="card-header" id="headingItaliano">
          <h2 class="mb-0">
            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseItaliano">
              Lingua e Letteratura Italiana
            </button>
          </h2>
        </div>
        <div id="collapseItaliano" class="collapse" data-parent="#materialsAccordion">
          <div class="card-body">
            <ul id="listItaliano" class="list-unstyled"></ul>
          </div>
        </div>
      </div>
      <!-- Matematica -->
      <div class="card">
        <div class="card-header" id="headingMatematica">
          <h2 class="mb-0">
            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseMatematica">
              Matematica
            </button>
          </h2>
        </div>
        <div id="collapseMatematica" class="collapse" data-parent="#materialsAccordion">
          <div class="card-body">
            <ul id="listMatematica" class="list-unstyled"></ul>
          </div>
        </div>
      </div>
      <!-- Aggiungi altre materie qui... -->
    </div>
  </div>

  <!-- jQuery, Popper, Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    // Materie e ID categorie
    const categories = {
      Italiano: 'listItaliano',
      Matematica: 'listMatematica'
      // aggiungi qui: Inglese: 'listInglese', ...
    };

    // Carica tutti i materiali e popola le liste
    $.getJSON('/api/materials', data => {
      if (data.success) {
        data.materials.forEach(mat => {
          // mat.subject deve corrispondere a una chiave di categories
          const ulId = categories[mat.subject];
          if (ulId) {
            $('#' + ulId).append(`
              <li>
                <a href="material.html?id=${mat._id}">${mat.title}</a>
              </li>
            `);
          }
        });
      }
    });

    // Navbar dinamica
    $(function(){
      const token = localStorage.getItem('token');
      if (token) {
        $('#auth-area').html(`<a href="area.html" class="btn btn-light">Area Personale</a>`);
      } else {
        $('#auth-area').html(`<a href="login.html" class="btn btn-light">Accedi/Registrati</a>`);
      }
    });
  </script>
</body>
</html>
