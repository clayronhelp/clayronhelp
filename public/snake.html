<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8"><meta name="viewport"content="width=device-width,initial-scale=1">
  <title>Snake â€“ ClayRon</title>
  <link rel="icon" href="assets/img/logo.png">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    body { display:flex; flex-direction:column; min-height:100vh; }
    #gameContainer { flex:1; display:flex; justify-content:center; align-items:center; }
    canvas { background:#000; border:4px solid #0055aa; border-radius:8px; }
    #controls { text-align:center; margin:1rem; }
    #leaderboard { max-width:300px; margin:1rem auto; }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand text-white" href="fun.html"><i class="fas fa-arrow-left pr-2"></i>Snake</a>
    </div>
  </nav>

  <div id="gameContainer">
    <canvas id="snakeCanvas" width="400" height="400"></canvas>
  </div>
  <div id="controls">
    <button id="btnStart" class="btn btn-success mx-1">Avvia</button>
    <button id="btnRestart" class="btn btn-warning mx-1" disabled>Restart</button>
    <span class="ml-3">Punteggio: <strong id="score">0</strong></span>
  </div>

  <div id="leaderboard" class="card p-3 shadow-sm">
    <h5 class="text-center">Classifica</h5>
    <ol id="boardList"></ol>
  </div>

  <footer class="py-3 bg-primary text-white text-center mt-auto">&copy; 2025 ClayRon</footer>

  <script>
    const canvas = document.getElementById('snakeCanvas'),
          ctx = canvas.getContext('2d'),
          grid=20, size=20;
    let snake, dir, apple, score, interval;

    function resetGame(){
      snake=[{x:10,y:10}]; dir={x:1,y:0};
      apple={x:Math.floor(Math.random()*size),y:Math.floor(Math.random()*size)};
      score=0; document.getElementById('score').innerText=score;
      loadLeaderboard();
      document.getElementById('btnRestart').disabled=false;
    }

    function draw(){
      // muovi
      const head={x:snake[0].x+dir.x, y:snake[0].y+dir.y};
      snake.unshift(head);
      if(head.x===apple.x && head.y===apple.y){
        score++; document.getElementById('score').innerText=score;
        apple={x:Math.floor(Math.random()*size),y:Math.floor(Math.random()*size)};
      } else snake.pop();
      // collisioni (muri o se stesso)
      if(head.x<0||head.x>=size||head.y<0||head.y>=size||snake.slice(1).some(p=>p.x===head.x && p.y===head.y)){
        clearInterval(interval);
        saveScore(score);
        return;
      }
      // disegna
      ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle='lime'; snake.forEach(p=>ctx.fillRect(p.x*grid,p.y*grid,grid-2,grid-2));
      ctx.fillStyle='red'; ctx.fillRect(apple.x*grid,apple.y*grid,grid-2,grid-2);
    }

    document.addEventListener('keydown',e=>{
      if(e.key==='ArrowUp' && dir.y===0) dir={x:0,y:-1};
      if(e.key==='ArrowDown' && dir.y===0) dir={x:0,y:1};
      if(e.key==='ArrowLeft' && dir.x===0) dir={x:-1,y:0};
      if(e.key==='ArrowRight'&&dir.x===0) dir={x:1,y:0};
    });

    document.getElementById('btnStart').onclick = ()=>{
      resetGame();
      interval = setInterval(draw,100);
      document.getElementById('btnStart').disabled=true;
    };
    document.getElementById('btnRestart').onclick = ()=>{
      clearInterval(interval);
      document.getElementById('btnStart').disabled=false;
      resetGame();
    };

    // leaderboard via localStorage
    function loadLeaderboard(){
      const list = JSON.parse(localStorage.getItem('snakeBoard')||'[]')
                   .sort((a,b)=>b.score-a.score).slice(0,5);
      const ol = document.getElementById('boardList'); ol.innerHTML='';
      list.forEach(r=> ol.innerHTML+=`<li>${r.name}: ${r.score}</li>`);
    }
    function saveScore(s){
      const name = prompt('Hai totalizzato '+s+' punti! Inserisci il tuo nome:','Player');
      if(!name) return;
      const arr = JSON.parse(localStorage.getItem('snakeBoard')||'[]');
      arr.push({name,score:s});
      localStorage.setItem('snakeBoard',JSON.stringify(arr));
      loadLeaderboard();
    }

    // init
    loadLeaderboard();
  </script>
</body>
</html>
