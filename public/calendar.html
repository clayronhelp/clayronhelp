<!DOCTYPE html>
<html lang="it">
<head>
  <!-- … meta, link e script come prima … -->
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet'/>
  <style>
    #calendar {
      max-width:900px;
      margin: 0 auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      padding: 1rem;
    }
    /* toolbar */
    .fc .fc-toolbar-chunk, .fc .fc-col-header-cell-cushion {
      background: #003366;
      color: #fff;
      border-radius: 4px;
      padding: 0.5rem;
    }
    .fc-button {
      background: #0055aa;
      border: none;
      color: #fff;
      border-radius: 4px;
      margin: 0 0.2rem;
    }
    .fc-button:hover {
      background: #004080;
    }
    /* numeri giorni */
    .fc-daygrid-day-number {
      color: #0055aa;
      font-weight: 500;
    }
    /* eventi */
    .fc-event {
      background-color: #28a745 !important;
      border: none !important;
      border-radius: 4px;
      color: #fff !important;
      padding: 2px 4px;
    }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">
      <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark shadow-sm">
      <div class="container">
        <a class="navbar-brand" href="index.html">
          <img src="assets/img/logo.png" alt="Logo" class="logo"> ClayRon S.P.A.
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavHome"
          aria-controls="navbarNavHome" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <!-- La navbar con link comuni -->
        <div class="collapse navbar-collapse" id="navbarNavHome">
          <ul class="navbar-nav ml-auto" id="nav-links">
            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="materials.html">Materiali</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">Chi Siamo</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">Contatti</a></li>
          </ul>
          <!-- L'area di autenticazione verrà aggiornata dinamicamente -->
          <div id="auth-area">
            <a href="login.html" class="btn btn-outline-light ml-2">Accedi/Registrati</a>
          </div>
        </div>
      </div>
    </nav>

  <main class="container flex-fill py-5">
    <h2 class="mb-4 text-center">Calendario</h2>
    <div id="calendar"></div>
  </main>

  <!-- footer … -->

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const { data:{session} } = await supabase.auth.getSession();
      if (!session) return location.href='login.html';

      const calendarEl = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        locale: 'it',
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        selectable: true,
        select: info => {
          const titolo = prompt('Titolo (es: Verifica Italiano):');
          if (titolo) {
            calendar.addEvent({ title: titolo, start: info.startStr, allDay: true });
            let ev = JSON.parse(localStorage.getItem('myEvents')||'[]');
            ev.push({ title: titolo, start: info.startStr, allDay: true });
            localStorage.setItem('myEvents', JSON.stringify(ev));
          }
          calendar.unselect();
        },
        events: JSON.parse(localStorage.getItem('myEvents')||'[]'),
        eventClick: info => {
          if (confirm(`Eliminare "${info.event.title}"?`)) {
            info.event.remove();
            let ev = JSON.parse(localStorage.getItem('myEvents')||'[]')
                      .filter(e=>!(e.title===info.event.title && e.start===info.event.startStr));
            localStorage.setItem('myEvents', JSON.stringify(ev));
          }
        }
      });
      calendar.render();
    });
  </script>
</body>
</html>
